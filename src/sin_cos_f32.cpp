/*
 * sin_cos_f32.cpp
 *
 *  Created on: 5 мая 2018 г.
 *      Author: Виталий
 */

#include "sin_cos_f32.h"

#include <cstddef>


/*
 * sinTable is generated by: for (i=0; i < 450; ++i) sinTable[i] = sin(i * 2 * PI / 3600); sinTable[451] = 1;
 */
static constexpr float sinTable[452] = {
   0.000000000000000F,  0.017452406437284F,  0.034899496702501F,  0.052335956242944F,  0.069756473744125F,
   0.087155742747658F,  0.104528463267653F,  0.121869343405147F,  0.139173100960065F,  0.156434465040231F,
   0.173648177666930F,  0.190808995376545F,  0.207911690817759F,  0.224951054343865F,  0.241921895599668F,
   0.258819045102521F,  0.275637355816999F,  0.292371704722737F,  0.309016994374947F,  0.325568154457157F,
   0.342020143325669F,  0.358367949545300F,  0.374606593415912F,  0.390731128489274F,  0.406736643075800F,
   0.422618261740699F,  0.438371146789077F,  0.453990499739547F,  0.469471562785891F,  0.484809620246337F,
   0.500000000000000F,  0.515038074910054F,  0.529919264233205F,  0.544639035015027F,  0.559192903470747F,
   0.573576436351046F,  0.587785252292473F,  0.601815023152048F,  0.615661475325658F,  0.629320391049837F,
   0.642787609686539F,  0.656059028990507F,  0.669130606358858F,  0.681998360062498F,  0.694658370458997F,
   0.707106781186547F,  0.719339800338651F,  0.731353701619170F,  0.743144825477394F,  0.754709580222772F,
   0.766044443118978F,  0.777145961456971F,  0.788010753606722F,  0.798635510047293F,  0.809016994374947F,
   0.819152044288992F,  0.829037572555042F,  0.838670567945424F,  0.848048096156426F,  0.857167300702112F,
   0.866025403784439F,  0.874619707139396F,  0.882947592858927F,  0.891006524188368F,  0.898794046299167F,
   0.906307787036650F,  0.913545457642601F,  0.920504853452440F,  0.927183854566787F,  0.933580426497202F,
   0.939692620785908F,  0.945518575599317F,  0.951056516295154F,  0.956304755963035F,  0.961261695938319F,
   0.965925826289068F,  0.970295726275996F,  0.974370064785235F,  0.978147600733806F,  0.981627183447664F,
   0.984807753012208F,  0.987688340595138F,  0.990268068741570F,  0.992546151641322F,  0.994521895368273F,
   0.996194698091746F,  0.997564050259824F,  0.998629534754574F,  0.999390827019096F,  0.999847695156391F,
   1.000000000000000F,  0.999847695156391F,  0.999390827019096F,  0.998629534754574F,  0.997564050259824F,
   0.996194698091746F,  0.994521895368273F,  0.992546151641322F,  0.990268068741570F,  0.987688340595138F,
   0.984807753012208F,  0.981627183447664F,  0.978147600733806F,  0.974370064785235F,  0.970295726275996F,
   0.965925826289068F,  0.961261695938319F,  0.956304755963036F,  0.951056516295154F,  0.945518575599317F,
   0.939692620785908F,  0.933580426497202F,  0.927183854566787F,  0.920504853452440F,  0.913545457642601F,
   0.906307787036650F,  0.898794046299167F,  0.891006524188368F,  0.882947592858927F,  0.874619707139396F,
   0.866025403784439F,  0.857167300702112F,  0.848048096156426F,  0.838670567945424F,  0.829037572555042F,
   0.819152044288992F,  0.809016994374947F,  0.798635510047293F,  0.788010753606722F,  0.777145961456971F,
   0.766044443118978F,  0.754709580222772F,  0.743144825477394F,  0.731353701619171F,  0.719339800338651F,
   0.707106781186548F,  0.694658370458997F,  0.681998360062499F,  0.669130606358858F,  0.656059028990507F,
   0.642787609686539F,  0.629320391049838F,  0.615661475325658F,  0.601815023152048F,  0.587785252292473F,
   0.573576436351046F,  0.559192903470747F,  0.544639035015027F,  0.529919264233205F,  0.515038074910054F,
   0.500000000000000F,  0.484809620246337F,  0.469471562785891F,  0.453990499739547F,  0.438371146789077F,
   0.422618261740699F,  0.406736643075800F,  0.390731128489274F,  0.374606593415912F,  0.358367949545300F,
   0.342020143325669F,  0.325568154457157F,  0.309016994374948F,  0.292371704722737F,  0.275637355817000F,
   0.258819045102521F,  0.241921895599668F,  0.224951054343865F,  0.207911690817759F,  0.190808995376545F,
   0.173648177666930F,  0.156434465040231F,  0.139173100960066F,  0.121869343405148F,  0.104528463267654F,
   0.087155742747657F,  0.069756473744126F,  0.052335956242944F,  0.034899496702501F,  0.017452406437283F,
   0.000000000000000F, -0.017452406437283F, -0.034899496702501F, -0.052335956242944F, -0.069756473744125F,
  -0.087155742747658F, -0.104528463267653F, -0.121869343405148F, -0.139173100960066F, -0.156434465040231F,
  -0.173648177666930F, -0.190808995376545F, -0.207911690817759F, -0.224951054343865F, -0.241921895599668F,
  -0.258819045102520F, -0.275637355816999F, -0.292371704722736F, -0.309016994374948F, -0.325568154457157F,
  -0.342020143325669F, -0.358367949545300F, -0.374606593415912F, -0.390731128489274F, -0.406736643075800F,
  -0.422618261740699F, -0.438371146789077F, -0.453990499739546F, -0.469471562785891F, -0.484809620246337F,
  -0.500000000000000F, -0.515038074910054F, -0.529919264233205F, -0.544639035015027F, -0.559192903470747F,
  -0.573576436351046F, -0.587785252292473F, -0.601815023152048F, -0.615661475325658F, -0.629320391049838F,
  -0.642787609686539F, -0.656059028990507F, -0.669130606358858F, -0.681998360062498F, -0.694658370458997F,
  -0.707106781186547F, -0.719339800338651F, -0.731353701619170F, -0.743144825477394F, -0.754709580222772F,
  -0.766044443118978F, -0.777145961456971F, -0.788010753606722F, -0.798635510047293F, -0.809016994374947F,
  -0.819152044288992F, -0.829037572555041F, -0.838670567945424F, -0.848048096156426F, -0.857167300702112F,
  -0.866025403784438F, -0.874619707139396F, -0.882947592858927F, -0.891006524188368F, -0.898794046299167F,
  -0.906307787036650F, -0.913545457642601F, -0.920504853452440F, -0.927183854566787F, -0.933580426497202F,
  -0.939692620785908F, -0.945518575599317F, -0.951056516295154F, -0.956304755963035F, -0.961261695938319F,
  -0.965925826289068F, -0.970295726275996F, -0.974370064785235F, -0.978147600733806F, -0.981627183447664F,
  -0.984807753012208F, -0.987688340595138F, -0.990268068741570F, -0.992546151641322F, -0.994521895368273F,
  -0.996194698091746F, -0.997564050259824F, -0.998629534754574F, -0.999390827019096F, -0.999847695156391F,
  -1.000000000000000F, -0.999847695156391F, -0.999390827019096F, -0.998629534754574F, -0.997564050259824F,
  -0.996194698091746F, -0.994521895368273F, -0.992546151641322F, -0.990268068741570F, -0.987688340595138F,
  -0.984807753012208F, -0.981627183447664F, -0.978147600733806F, -0.974370064785235F, -0.970295726275997F,
  -0.965925826289068F, -0.961261695938319F, -0.956304755963035F, -0.951056516295154F, -0.945518575599317F,
  -0.939692620785909F, -0.933580426497202F, -0.927183854566787F, -0.920504853452440F, -0.913545457642601F,
  -0.906307787036650F, -0.898794046299167F, -0.891006524188368F, -0.882947592858927F, -0.874619707139396F,
  -0.866025403784439F, -0.857167300702112F, -0.848048096156426F, -0.838670567945424F, -0.829037572555042F,
  -0.819152044288992F, -0.809016994374948F, -0.798635510047293F, -0.788010753606722F, -0.777145961456971F,
  -0.766044443118978F, -0.754709580222772F, -0.743144825477395F, -0.731353701619171F, -0.719339800338652F,
  -0.707106781186548F, -0.694658370458998F, -0.681998360062498F, -0.669130606358858F, -0.656059028990507F,
  -0.642787609686540F, -0.629320391049838F, -0.615661475325659F, -0.601815023152048F, -0.587785252292473F,
  -0.573576436351046F, -0.559192903470747F, -0.544639035015027F, -0.529919264233206F, -0.515038074910054F,
  -0.500000000000000F, -0.484809620246337F, -0.469471562785891F, -0.453990499739547F, -0.438371146789077F,
  -0.422618261740700F, -0.406736643075800F, -0.390731128489275F, -0.374606593415912F, -0.358367949545301F,
  -0.342020143325669F, -0.325568154457158F, -0.309016994374948F, -0.292371704722736F, -0.275637355817000F,
  -0.258819045102521F, -0.241921895599668F, -0.224951054343865F, -0.207911690817760F, -0.190808995376545F,
  -0.173648177666931F, -0.156434465040231F, -0.139173100960066F, -0.121869343405148F, -0.104528463267653F,
  -0.087155742747658F, -0.069756473744125F, -0.052335956242944F, -0.034899496702501F, -0.017452406437284F,
   0.0000000000000000F, 0.017452406437284F,  0.034899496702501F,  0.052335956242944F,  0.069756473744125F,
   0.087155742747658F,  0.104528463267653F,  0.121869343405147F,  0.139173100960065F,  0.156434465040231F,
   0.173648177666930F,  0.190808995376545F,  0.207911690817759F,  0.224951054343865F,  0.241921895599668F,
   0.258819045102521F,  0.275637355816999F,  0.292371704722737F,  0.309016994374947F,  0.325568154457157F,
   0.342020143325669F,  0.358367949545300F,  0.374606593415912F,  0.390731128489274F,  0.406736643075800F,
   0.422618261740699F,  0.438371146789077F,  0.453990499739547F,  0.469471562785891F,  0.484809620246337F,
   0.500000000000000F,  0.515038074910054F,  0.529919264233205F,  0.544639035015027F,  0.559192903470747F,
   0.573576436351046F,  0.587785252292473F,  0.601815023152048F,  0.615661475325658F,  0.629320391049837F,
   0.642787609686539F,  0.656059028990507F,  0.669130606358858F,  0.681998360062498F,  0.694658370458997F,
   0.707106781186547F,  0.719339800338651F,  0.731353701619170F,  0.743144825477394F,  0.754709580222772F,
   0.766044443118978F,  0.777145961456971F,  0.788010753606722F,  0.798635510047293F,  0.809016994374947F,
   0.819152044288992F,  0.829037572555042F,  0.838670567945424F,  0.848048096156426F,  0.857167300702112F,
   0.866025403784439F,  0.874619707139396F,  0.882947592858927F,  0.891006524188368F,  0.898794046299167F,
   0.906307787036650F,  0.913545457642601F,  0.920504853452440F,  0.927183854566787F,  0.933580426497202F,
   0.939692620785908F,  0.945518575599317F,  0.951056516295154F,  0.956304755963035F,  0.961261695938319F,
   0.965925826289068F,  0.970295726275996F,  0.974370064785235F,  0.978147600733806F,  0.981627183447664F,
   0.984807753012208F,  0.987688340595138F,  0.990268068741570F,  0.992546151641322F,  0.994521895368273F,
   0.996194698091746F,  0.997564050259824F,  0.998629534754574F,  0.999390827019096F,  0.999847695156391F,
   1.000000000000000F,  1.000000000000000F
};


/*
 * input angle_degree must be in range [0, 360]
 * use optimization: cos(a) = sin(a+90)
 */
MATH_vec2 sin_cos_f32(const float angle_degree)
{
    const size_t i = static_cast<size_t>(angle_degree);
    const float ysin_low  = sinTable[i];
    const float ysin_high = sinTable[i+1];
    const float ycos_low  = sinTable[i+90];
    const float ycos_high = sinTable[i+91];
    const float x_delta   = angle_degree - static_cast<float>(i);
    const float sin_value = x_delta * (ysin_high - ysin_low) + ysin_low;
    const float cos_value = x_delta * (ycos_high - ycos_low) + ycos_low;
    return {sin_value, cos_value};
}


/*
 * input angle_pu must be in range [0,1]
 */
MATH_vec2 sin_cos_pu_f32(const float angle_pu)
{
    constexpr float SCALE_PU_TO_DEGREE = 360.0F;
    return sin_cos_f32(angle_pu * SCALE_PU_TO_DEGREE);
}
